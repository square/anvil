apply plugin: 'org.jetbrains.kotlin.jvm'
apply plugin: 'org.jetbrains.kotlin.kapt'
apply plugin: 'com.vanniktech.maven.publish'

dependencies {
  implementation project(':annotations')
  implementation deps.dagger2.dagger
  implementation deps.dagger2.android
  implementation deps.jsr250
  implementation deps.kotlin.stdlib
  implementation deps.kotlinpoet

  compileOnly deps.auto.service.annotations
  compileOnly deps.kotlin.compiler
  compileOnly deps.dagger2.compiler_android

  kapt deps.auto.service.processor

  testImplementation deps.dagger2.compiler
  testImplementation deps.dagger2.compiler_android
  testImplementation deps.kotlin.compile_testing
  testImplementation deps.kotlin.compiler
  testImplementation deps.truth
}

//noinspection UnnecessaryQualifiedReference
tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
  kotlinOptions {
    jvmTarget = JavaVersion.VERSION_1_8
    freeCompilerArgs += "-Xopt-in=kotlin.RequiresOptIn"

    // TODO: remove the if-check when upgrading to Kotlin 1.4.
    if (rootProject.ext.kotlinVersion.startsWith('1.4')) {
      // The flag is needed because we extend an interface that uses @JvmDefault and the Kotlin
      // compiler requires this flag when doing so.
      freeCompilerArgs += "-Xjvm-default=enable"
    }
  }
}
